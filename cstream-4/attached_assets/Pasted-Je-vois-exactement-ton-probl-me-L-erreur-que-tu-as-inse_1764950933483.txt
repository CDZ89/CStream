Je vois exactement ton problÃ¨me ðŸ‘€. Lâ€™erreur que tu as :  

```
insert or update on table "friendships" violates foreign key constraint "friendships_user_id_fkey"
```

signifie que tu essaies dâ€™insÃ©rer une ligne dans la table `friendships` avec un `user_id` (ou `friend_id`) qui **nâ€™existe pas dans la table `users`**. En clair : ta contrainte de clÃ© Ã©trangÃ¨re bloque lâ€™ajout car lâ€™ID nâ€™est pas valide.

---

## ðŸ”Ž Pourquoi Ã§a arrive
- Tu as une table `friendships` avec une contrainte :
  ```sql
  FOREIGN KEY (user_id) REFERENCES users(id)
  ```
- Quand tu fais un `INSERT`, Supabase vÃ©rifie que `user_id` existe dans `users.id`.  
- Si tu passes un mauvais ID (ou un ID qui nâ€™existe pas encore), Ã§a plante.

---

## âœ… Solution : refaire une base propre

### 1. Table `users`
On dÃ©finit une table claire pour les profils :

```sql
CREATE TABLE users (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  username text UNIQUE NOT NULL,
  created_at timestamp DEFAULT now()
);
```

ðŸ‘‰ Ici, chaque utilisateur a un vrai `id` gÃ©nÃ©rÃ© automatiquement (`uuid`).

---

### 2. Table `friendships`
On crÃ©e une table pour gÃ©rer les relations dâ€™amitiÃ© :

```sql
CREATE TABLE friendships (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  friend_id uuid NOT NULL,
  created_at timestamp DEFAULT now(),
  CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  CONSTRAINT fk_friend FOREIGN KEY (friend_id) REFERENCES users(id) ON DELETE CASCADE,
  CONSTRAINT unique_friendship UNIQUE (user_id, friend_id)
);
```

ðŸ‘‰ Points importants :
- Les deux colonnes (`user_id` et `friend_id`) pointent vers `users.id`.
- `ON DELETE CASCADE` supprime les amitiÃ©s si un utilisateur est supprimÃ©.
- `UNIQUE (user_id, friend_id)` Ã©vite les doublons.

---

### 3. Exemple dâ€™insertion
Avant dâ€™ajouter une amitiÃ©, il faut que les deux utilisateurs existent :

```sql
INSERT INTO users (username) VALUES ('Alice');
INSERT INTO users (username) VALUES ('Bob');

-- RÃ©cupÃ¨re les IDs
SELECT * FROM users;

-- Ajoute lâ€™amitiÃ©
INSERT INTO friendships (user_id, friend_id)
VALUES ('id_de_Alice', 'id_de_Bob');
```

---

### 4. CÃ´tÃ© Supabase (JS)
Ton code doit utiliser les vrais IDs :

```js
const { data, error } = await supabase
  .from('friendships')
  .insert([
    { user_id: currentUser.id, friend_id: friendId }
  ]);

if (error) console.error(error);
```

---

### 5. Widget centrÃ© et propre (v0.3 style)
En front, tu peux isoler ton chat ou ton widget dans un conteneur centrÃ© :

```css
.widget {
  width: 400px;
  margin: 0 auto;        /* centre horizontalement */
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 10px;
  background: #fff;
}
```

---

ðŸ‘‰ En rÃ©sumÃ© :  
- **Refais ta table `users` avec des UUID**.  
- **Refais ta table `friendships` avec des clÃ©s Ã©trangÃ¨res propres**.  
- **Toujours insÃ©rer des IDs qui existent dans `users`**.  
- **Ton widget doit avoir une taille fixe et Ãªtre centrÃ© avec `margin: auto`**.

---

Tu veux que je tâ€™Ã©crive le script SQL complet (crÃ©ation des tables + policies Supabase pour que lâ€™ajout marche direct) afin que tu puisses le coller dans ton projet et repartir sur une base clean ?