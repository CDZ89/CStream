âš™ï¸ Ã‰tapes pour configurer OAuth2 Discord avec ton site
1. CrÃ©er ton application Discord
Va sur Discord Developer Portal.

CrÃ©e une nouvelle application (ex. CStream Verify).

RÃ©cupÃ¨re ton Client ID et Client Secret.

Dans OAuth2 â†’ Redirects, ajoute :

Code
https://cstream--trte11.replit.app/api/auth/discord/callback
2. Construire lâ€™URL dâ€™autorisation
Câ€™est lâ€™URL que tu mets dans ton embed Discord (bouton Â« VÃ©rifier Â») :

Code
https://discord.com/oauth2/authorize?client_id=TON_CLIENT_ID&redirect_uri=https%3A%2F%2Fcstream--trte11.replit.app%2Fapi%2Fauth%2Fdiscord%2Fcallback&response_type=code&scope=identify%20guilds
client_id = ton Client ID Discord.

redirect_uri = lâ€™URL callback de ton site (encodÃ©e).

scope = identify (pour rÃ©cupÃ©rer lâ€™ID utilisateur) + Ã©ventuellement guilds.

3. ImplÃ©menter la route /api/auth/discord/callback
Sur ton site (Next.js ou Express), tu crÃ©es une route qui :

RÃ©cupÃ¨re le code envoyÃ© par Discord.

Ã‰change ce code contre un access token via POST https://discord.com/api/oauth2/token.

Utilise lâ€™access_token pour appeler :

Code
GET https://discord.com/api/users/@me
Authorization: Bearer ACCESS_TOKEN
â†’ Tu obtiens lâ€™ID Discord de lâ€™utilisateur.

Tu stockes cet ID dans ta base (ex. Supabase) et tu lâ€™associes au compte du site.

4. Synchroniser avec ton bot
Ton site appelle une API de ton bot (ou envoie un webhook) avec lâ€™ID Discord vÃ©rifiÃ©.

Le bot ajoute le rÃ´le VÃ©rifiÃ© Ã  lâ€™utilisateur dans ton serveur.

Dans ton site, la section Â« Comptes liÃ©s Â» affiche Discord comme liÃ©.

5. Embed permanent dans Discord
Commande /verify de ton bot envoie un embed avec bouton Â« VÃ©rifier mon compte Â».

Ce bouton pointe vers https://cstream--trte11.replit.app/verify.

Lâ€™utilisateur suit le flux â†’ revient sur Discord avec rÃ´le attribuÃ©.

ğŸ›¡ï¸ Points pour Ã©viter les bugs
VÃ©rifie que ton redirect URI est exactement identique dans le Developer Portal et ton code.

Ne mets jamais ton Client Secret cÃ´tÃ© front, uniquement cÃ´tÃ© serveur.

Donne au bot la permission Manage Roles.

Teste avec un compte test avant de dÃ©ployer.