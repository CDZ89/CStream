Pour obtenir exactement ce que tu veux â€” une IA qui Ã©crit en live, lettre par lettre, avec effet flou â†’ net, sans blocs qui tombent dâ€™un coup â€” il faut combiner trois Ã©lÃ©ments dans ton frontâ€‘end :

1. Streaming token par token
Utilise lâ€™API en mode stream: true.

Lis le flux avec un ReadableStream (res.body.getReader()).

Chaque delta.content correspond Ã  un morceau de texte (souvent un caractÃ¨re ou un mot).

Tu lâ€™ajoutes immÃ©diatement au DOM au lieu dâ€™attendre la fin.

js
const reader = res.body.getReader();
const decoder = new TextDecoder("utf-8");
let buffer = "";

while (true) {
  const { value, done } = await reader.read();
  if (done) break;
  buffer += decoder.decode(value, { stream: true });

  const lines = buffer.split("\n");
  buffer = lines.pop() || "";

  for (const line of lines) {
    if (!line.startsWith("data:")) continue;
    const payload = line.slice(5).trim();
    if (payload === "[DONE]") return;
    const json = JSON.parse(payload);
    const delta = json?.choices?.[0]?.delta?.content || "";
    if (delta) appendToken(delta);
  }
}
2. Effet flou â†’ net
Chaque caractÃ¨re est insÃ©rÃ© dans un <span> avec une classe .token-blur.
Puis, aprÃ¨s un court dÃ©lai, tu enlÃ¨ves le flou.

css
.token-blur {
  filter: blur(2.6px);
  opacity: 0.85;
  transition: filter .28s ease, opacity .28s ease;
}
.token-blur.done {
  filter: blur(0);
  opacity: 1;
}
js
function appendToken(char) {
  const span = document.createElement("span");
  span.className = "token-blur";
  span.textContent = char;
  assistantDiv.appendChild(span);
  requestAnimationFrame(() => {
    setTimeout(() => span.classList.add("done"), 120); // dÃ©lai pour lâ€™effet
  });
}
3. Rendu Markdown incrÃ©mental
Tu accumules le texte complet dans un buffer.

Tous les ~100â€“150 caractÃ¨res, tu reâ€‘rends le Markdown avec Marked.js + DOMPurify.

Ã‡a permet de garder les titres, listes, tableaux, code stylÃ©s, tout en ayant lâ€™effet live.

js
let bufferText = "";
let ticker = 0;

function appendToken(char) {
  bufferText += char;
  // effet flou
  const span = document.createElement("span");
  span.className = "token-blur";
  span.textContent = char;
  assistantDiv.appendChild(span);
  requestAnimationFrame(() => setTimeout(() => span.classList.add("done"), 120));

  ticker++;
  if (ticker > 150) {
    ticker = 0;
    renderMarkdown(bufferText);
  }
}

function renderMarkdown(text) {
  const rawHtml = marked.parse(text);
  const safeHtml = DOMPurify.sanitize(rawHtml);
  assistantDiv.innerHTML = safeHtml;
  assistantDiv.querySelectorAll("pre code").forEach(block => hljs.highlightElement(block));
}
RÃ©sultat attendu
Lâ€™IA tape doucement, caractÃ¨re par caractÃ¨re.

Chaque lettre apparaÃ®t floue puis devient nette.

Le texte final est Markdown complet (titres, listes, tableaux, code).

Les blocs de code sont colorÃ©s et copiable.

Les liens sont enrichis avec cartes.

ğŸ‘‰ En rÃ©sumÃ© :

Streaming = pas de blocs, mais tokens en direct.

Effet flou â†’ net = chaque caractÃ¨re a une animation.

Markdown reâ€‘render = style propre pour tableaux, code, liens.